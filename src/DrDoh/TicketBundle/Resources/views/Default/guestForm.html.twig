{% extends "::layout.html.twig"%}

{% block title %} 
    {{parent()}} Billetterie 
{% endblock %}

{% block body  %}
   <div class="container">
        <h2 class="text-white m-4">Bienvenue</h2> 
   
        <div class="card text-white bg-dark mb-3">
            <h3 class="card-header text-center">
            <em>
                Vous prevoyez une visite pour la {{app.request.request.get("choix")}} du {{app.request.request.get("date")}} <br>
                <br>
                Indiquez vos coordonnées pour la reservation de {{app.request.request.get("ticket_qte")}} billet(s).  
            <em>
            </h3>
{# vvvvv ------------vvvvvvv---------FORMULAIRE(S) BUYER ------------vvvvvvv---------vvvvv #}
            <div class="card-body">
                <div class="text-right">
                    <h4 class="text-right">Visiteur 1</h4>
                </div>    
                <div class="well">
                    {{form_start(buyer_form)}}
                        {{form_errors(buyer_form)}}
                        {# NOM + PRENOM #}
                        <div class="form-row">
                            <div class="form-group col-md-6">
                                {{form_label(buyer_form.lastName,"Nom")}}
                                {{form_errors(buyer_form.lastName)}}
                                {{form_widget(buyer_form.lastName)}}
                            </div>

                            <div class="form-group col-md-6">
                                {{form_label(buyer_form.firstName,"Prénom")}}
                                {{form_errors(buyer_form.firstName)}}
                                {{form_widget(buyer_form.firstName)}}
                            </div>
                        </div>
                        {# DATE DE NAISSANCE + REDUCTION + PAYS #}
                        <div class="form-row">
                            <div class="form-group col-md-4">
                                {{form_label(buyer_form.birthDate,"Date de naissance")}}
                                {{form_errors(buyer_form.birthDate)}}
                                {{form_widget(buyer_form.birthDate)}}
                            </div>
                            <div class="form-group col-md-4">
                                {{form_label(buyer_form.discountType,"Réduction")}}
                                {{form_errors(buyer_form.discountType)}}
                                {{form_widget(buyer_form.discountType)}}
                            </div>
                            <div class="form-group col-md-4">
                                {{form_label(buyer_form.country,"Pays")}}
                                {{form_errors(buyer_form.country)}}
                                {{form_widget(buyer_form.country)}}
                            </div>
                        </div>
                        <div class="form-row">
                        <div class="form-group col-md-12">
                                {{form_label(buyer_form.email,"Adresse Email")}}
                                {{form_errors(buyer_form.email)}}
                                {{form_widget(buyer_form.email)}}
                            </div>
                        </div>
                </div>
            </div>
{# vvvvv ------------vvvvvvv---------FORMULAIRE(S) GUEST ------------vvvvvvv---------vvvvv #}
{% if guest_form is defined %}
            <div class="card-body">
                <div class="text-right">
                    <h4 class="text-right">Visiteur 2</h4>
                </div>    
                <div class="well">
                    {{form_start(guest_form)}}
                        {{form_errors(guest_form)}}
                        {# NOM + PRENOM #}
                        <div class="form-row">
                            <div class="form-group col-md-6">
                                {{form_label(guest_form.lastName,"Nom")}}
                                {{form_errors(guest_form.lastName)}}
                                {{form_widget(guest_form.lastName)}}
                            </div>

                            <div class="form-group col-md-6">
                                {{form_label(guest_form.firstName,"Prénom")}}
                                {{form_errors(guest_form.firstName)}}
                                {{form_widget(guest_form.firstName)}}
                            </div>
                        </div>
                        {# DATE DE NAISSANCE + REDUCTION + PAYS #}
                        <div class="form-row">
                            <div class="form-group col-md-4">
                                {{form_label(guest_form.birthDate,"Date de naissance")}}
                                {{form_errors(guest_form.birthDate)}}
                                {{form_widget(guest_form.birthDate)}}
                            </div>
                            <div class="form-group col-md-4">
                                {{form_label(guest_form.discountType,"Réduction")}}
                                {{form_errors(guest_form.discountType)}}
                                {{form_widget(guest_form.discountType)}}
                            </div>
                            <div class="form-group col-md-4">
                                {{form_label(guest_form.country,"Pays")}}
                                {{form_errors(guest_form.country)}}
                                {{form_widget(guest_form.country)}}
                            </div>
                        </div>
                </div>
            </div>
        </div>
{% endif %}
        <br>
{# vvvvv ------------vvvvvvv---------TABLEAU DE PRIX ------------vvvvvvv---------vvvvv #}       
        <div class="card text-white bg-dark mb-3">
            <h3 class="card-header text-center">
                Montant de votre commande
            </h3>
            <div class="card-body">
                <div class="well text-dark">
                    <table class="table table-striped table-light table-bordered">
                        <thead>
                            <tr>
                            <th scope="col">Billets</th>
                            <th scope="col">Quantité</th>
                            <th scope="col">Tarif unitaitre</th>
                            <th scope="col">Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                            <th scope="row">Plein Tarif</th>
                            <td id="qte_full_price" class="text-center">0</td>
                            <td id="one_full_price" class="text-center">16,00 €</td>
                            <td id="total_full_price" class="text-center"></td>
                            </tr>
                            <tr>
                            <th scope="row">Tarif enfant</th>
                            <td id="qte_child_price" class="text-center">0</td>
                            <td id="one_child_price" class="text-center">8,00 €</td>
                            <td id="total_child_price" class="text-center"></td>
                            </tr>
                            <tr>
                            <th scope="row">Tarif bébé</th>
                            <td id="qte_baby_price" class="text-center">0</td>
                            <td id="one_baby_price" class="text-center">0,00 €</td>
                            <td id="total_baby_price" class="text-center"></td>
                            </tr>
                            <th scope="row">Tarif Senior</th>
                            <td id="qte_older_price" class="text-center">0</td>
                            <td id="one_older_price" class="text-center">12,00 €</td>
                            <td id="total_older_price" class="text-center"></td>
                            </tr>
                            <th scope="row">Tarif réduit</th>
                            <td id="qte_discount_price" class="text-center">0</td>
                            <td id="one_discount_price" class="text-center">10,00 €</td>
                            <td id="total_discount_price" class="text-center"></td>
                            </tr>
                        </tbody>
                        <tfooter>
                            <tr>
                            <th scope="row"></th>
                            <td></td>
                            <th>Total</th>
                            <td id="total_price" class="text-center"></td>
                            </tr>
                        </tfooter>
                    </table>
{# vvvvv ------------vvvvvvv---------VALIDATION DE FORMULAIRE ------------vvvvvvv---------vvvvv #}                  
                <div class="mx-auto text-center alert alert-secondary">
                    <input id="checkBox" type="checkbox"><span> En cochant cette case, vous confirmez avoir lu et accepter les <a href="#">conditions générales d'utilisation</a></span>
                </div>
                
                <div class="mx-auto ">
                    {{form_widget(buyer_form.save,{ 'label': 'Poursuivre','attr':{'class':'btn btn-info btn-lg btn-block'}})}}

                    {{form_rest(buyer_form)}}
                    {{form_end(buyer_form)}}
                </div>
            </div>
        </div>
    </div> 
{% endblock %}


{# vvvvv ------------vvvvvvv--------- SCRIPT JS ------------vvvvvvv---------vvvvv #} 

{% block javascripts %}
 {{parent()}}

<script>

var choix = "{{app.request.request.get("choix")}}";
console.log(choix);

$(function(){

// --VVV-- Tarifs --VVV-- 
    var full_price = 16;
    var child_price = 8;
    var baby_price = 0;
    var older_price = 12;
    var discount_price = 10;

// --VVV-- Gestion de la colonne quantité --VVV-- 
    $('#qte_full_price').text("{{ticket_qte}}");
    $('#qte_child_price').text(0);
    $('#qte_baby_price').text(0);
    $('#qte_older_price').text(0);
    $('#qte_discount_price').text(0);


// --VVV-- Recuperation des quantités --VVV-- 
    var qte_full_price = $('#qte_full_price').text();
    var qte_child_price = $('#qte_child_price').text();
    var qte_baby_price = $('#qte_baby_price').text();
    var qte_older_price = $('#qte_older_price').text();
    var qte_discount_price = $('#qte_discount_price').text();

// --VVV-- Gestion de l'age --VVV-- 

    $('#drdoh_ticketbundle_guest_birthDate').change(function(){

        var jours = $('#drdoh_ticketbundle_guest_birthDate_day').val();
        var mois = $('#drdoh_ticketbundle_guest_birthDate_month').val();
        var année = $('#drdoh_ticketbundle_guest_birthDate_year').val();
        birthDate= new Date(année,mois,jours);
        visiteDate = new Date();
        console.log(birthDate);
        console.log(date);

    })


// --VVV-- Gestion des reduction --VVV--

    $('#drdoh_ticketbundle_guest_discountType').change(function(){
        var discountType = $('#drdoh_ticketbundle_guest_discountType').val();
        if(discountType != 50){
            qte_discount_price ++ ;
            if(qte_full_price>0){
                qte_full_price -- ;
            }
            $('#qte_discount_price').text(qte_discount_price);
            $('#qte_full_price').text(qte_full_price);
        }else{
            qte_discount_price -- ;
            qte_full_price ++ ;
            $('#qte_discount_price').text(qte_discount_price);
            $('#qte_full_price').text(qte_full_price);
        }
    });




// --VVV-- Calcul --VVV--     
    var total_full_price = qte_full_price * full_price;
    var total_child_price = qte_child_price * child_price;
    var total_baby_price = qte_baby_price * baby_price;
    var total_older_price = qte_older_price * older_price;
    var total_discount_price = qte_discount_price * discount_price;
    var total_price = total_full_price+total_child_price+total_baby_price+total_older_price+total_discount_price;

// --VVV-- Modification des valeur du tableau --VVV-- 
    $('#total_full_price').text(total_full_price+",00 €");
    $('#total_child_price').text(total_child_price+",00 €");
    $('#total_baby_price').text(total_baby_price+",00 €");
    $('#total_older_price').text(total_older_price+",00 €");
    $('#total_discount_price').text(total_discount_price+",00 €");
    $('#total_price').text(total_price+",00 €");

   
})


</script>

{% endblock %}

    
