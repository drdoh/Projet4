{% extends "::layout.html.twig"%}

{% block title %} 
    {{parent()}} Billetterie 
{% endblock %}

{% block body  %}
   <div class="container">
        <h2 class="text-white m-4">Bienvenue</h2> 
   
        <div class="card text-white bg-dark mb-3">
            <h3 class="card-header text-center">
            <em>
                Vous prevoyez une visite pour la {{app.request.request.get("choix")}} du {{app.request.request.get("date")}} <br>
                <br>
                Indiquez vos coordonnées pour la reservation de {{app.request.request.get("ticket_qte")}} billet(s).  
            <em>
            </h3>
{# vvvvv ------------vvvvvvv---------FORMULAIRE(S) BUYER ------------vvvvvvv---------vvvvv #}
                    {{form_start(form)}}
            <div class="card-body" id="form_card">
                <div class="text-right">
                    <h4 class="text-right" id="guest_index"></h4>
                </div>    
                <div class="well">
                        {{form_errors(form)}}
                        {# NOM + PRENOM #}
                        <div class="form-row">
                            <div class="form-group col-md-6">
                                {{form_errors(form.lastName)}}
                                {{form_widget(form.lastName)}}
                            </div>

                            <div class="form-group col-md-6">
                                {# {{form_errors(form.firstName)}}
                                {{form_widget(form.firstName)}} #}
                            </div>
                        </div>
                        {# DATE DE NAISSANCE + REDUCTION + PAYS #}
                        <div class="form-row">
                            <div class="form-group col-md-4">
                                {# {{form_errors(form.birthDate)}}
                                {{form_widget(form.birthDate)}} #}
                            </div>
                            <div class="form-group col-md-4">
                                {# {{form_errors(form.discount)}}
                                {{form_widget(form.discount)}} #}
                            </div>
                            <div class="form-group col-md-4">
                                {# {{form_errors(form.country)}}
                                {{form_widget(form.country)}} #}
                            </div>
                        </div>
                        {# EMAIL #}
                        <div class="form-row">
                        <div class="form-group col-md-12">
                                {# {{form_errors(form.email)}}
                                {{form_widget(form.email)}} #}
                            </div>
                        </div>
                </div>
            </div>
        <br>
{# vvvvv ------------vvvvvvv---------TABLEAU DE PRIX ------------vvvvvvv---------vvvvv #}       
        <div class="card text-white bg-dark mb-3">
            <h3 class="card-header text-center">
                Montant de votre commande
            </h3>
            <div class="card-body">
                <div class="well text-dark">
                    <table class="table table-striped table-light table-bordered">
                        <thead>
                            <tr>
                            <th scope="col">Billets</th>
                            <th scope="col">Quantité</th>
                            <th scope="col">Tarif unitaitre</th>
                            <th scope="col">Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                            <th scope="row">Plein Tarif</th>
                            <td id="qte_full_price" class="text-center">0</td>
                            <td id="one_full_price" class="text-center">16,00 €</td>
                            <td id="total_full_price" class="text-center"></td>
                            </tr>
                            <tr>
                            <th scope="row">Tarif enfant</th>
                            <td id="qte_child_price" class="text-center">0</td>
                            <td id="one_child_price" class="text-center">8,00 €</td>
                            <td id="total_child_price" class="text-center"></td>
                            </tr>
                            <tr>
                            <th scope="row">Tarif bébé</th>
                            <td id="qte_baby_price" class="text-center">0</td>
                            <td id="one_baby_price" class="text-center">0,00 €</td>
                            <td id="total_baby_price" class="text-center"></td>
                            </tr>
                            <th scope="row">Tarif Senior</th>
                            <td id="qte_older_price" class="text-center">0</td>
                            <td id="one_older_price" class="text-center">12,00 €</td>
                            <td id="total_older_price" class="text-center"></td>
                            </tr>
                            <th scope="row">Tarif réduit</th>
                            <td id="qte_discount_price" class="text-center">0</td>
                            <td id="one_discount_price" class="text-center">10,00 €</td>
                            <td id="total_discount_price" class="text-center"></td>
                            </tr>
                        </tbody>
                        <tfooter>
                            <tr>
                            <th scope="row"></th>
                            <td></td>
                            <th>Total</th>
                            <td id="total_price" class="text-center"></td>
                            </tr>
                        </tfooter>
                    </table>
{# vvvvv ------------vvvvvvv---------VALIDATION DE FORMULAIRE ------------vvvvvvv---------vvvvv #}                  
                <div class="mx-auto text-center alert alert-secondary">
                    {{form_widget(form.agreed, {'label': "En cochant cette case, vous confirmez avoir lu et accepter les <a href=''>conditions générales d'utilisation</a>"})}}
                </div>
                
                <div class="mx-auto ">
                    {{form_widget(form.save,{ 'label': 'Poursuivre','attr':{'class':'btn btn-info btn-lg btn-block'}})}}

                    {{form_rest(form)}}
                    {{form_end(form)}}
                </div>
            </div>
        </div>
    </div> 
{% endblock %}
{# vvvvv ------------vvvvvvv--------- SCRIPT JS ------------vvvvvvv---------vvvvv #} 
{% block javascripts %}
 {{parent()}}

<script>

 $(document).ready(function() {


    var $container = $('form');
    var index = parseInt("{{app.request.request.get("ticket_qte")}}");
    var i = 1;
    var div = 'div#drdoh_ticketbundle_buyer_';
    while(i <= index){
        if(i === 1 ){
            addCollection($('div#drdoh_ticketbundle_buyer_lastName'),$('div#drdoh_ticketbundle_buyer_lastName'), 'Nom');
            //addCollection($('div#drdoh_ticketbundle_buyer_firstName'),$('div#drdoh_ticketbundle_buyer_firstName'), 'Prenom');
            //addCollection($(div + 'birthDate'),$(div + 'birthDate'), 'Date de naissance');
            //addCollection($(div + 'discount'),$(div + 'discount'), 'Réduction');
            //addCollection($(div + 'country'),$(div + 'country'), 'Pays');
            //addCollection($(div + 'email'),$(div + 'email'), 'E-mail');
            $('#guest_index').text("Visiteur "+ i);
            i++;    
       }else{

            $('#form_card').append('<div class="text-right"><h4 class="text-right" id="guest_index">Visiteur '+i+'</h4></div>');
            $('#form_card').append('<div class="well" id="form_'+i+'"></div>');
            $('#form_' + i ).append('<div class="form-row 1"></div>');
            $('#form_' + i ).append('<div class="form-row 2"></div>');
            addCollection($('div#drdoh_ticketbundle_buyer_lastName'),$('#form_' + i + ' .1'), 'Nom');
            //addCollection($('div#drdoh_ticketbundle_buyer_firstName'),$('#form_' + i + ' .1'), 'Prenom');
            $('#form_' + i + ' .1 div').attr('class','form-group col-md-6');


            //addCollection($('div#drdoh_ticketbundle_buyer_birthDate'),$('#form_'+i+ ' .2'), 'Date de naissance');
            //addCollection($('div#drdoh_ticketbundle_buyer_discount'),$('#form_'+i+' .2'), 'Réduction');
            //addCollection($('div#drdoh_ticketbundle_buyer_country'),$('#form_'+i+' .2'), 'Pays');
            //$('#form_' + i + ' .2 > div').attr('class','form-group col-md-4');
            $('#form_' + i ).append('<hr>')
            i++;   
       }
    }

    // La fonction qui ajoute un formulaire
    function addCollection($model, $cible, label) {
        var $newModel= $model.clone()
        var template = $newModel.attr('data-prototype')
            .replace(/__name__label__/g, label)
            .replace(/__name__/g,        i)
        ;
        var $prototype = $(template);
        $cible.append($prototype);
    }

  });


// --VVV--________________GESTION DU TABLEAU DE PRIX__________________--VVV-- 
$(function(){
// --VVV-- Tarifs --VVV-- 
    var full_price = 16;
    var child_price = 8;
    var baby_price = 0;
    var older_price = 12;
    var discount_price = 10;

// --VVV-- Gestion de la colonne quantité --VVV-- 
    $('#qte_full_price').text("{{ticket_qte}}");
    $('#qte_child_price').text(0);
    $('#qte_baby_price').text(0);
    $('#qte_older_price').text(0);
    $('#qte_discount_price').text(0);


// --VVV-- Recuperation des quantités --VVV-- 
    var qte_full_price = $('#qte_full_price').text();
    var qte_child_price = $('#qte_child_price').text();
    var qte_baby_price = $('#qte_baby_price').text();
    var qte_older_price = $('#qte_older_price').text();
    var qte_discount_price = $('#qte_discount_price').text();

// --VVV-- Gestion de l'age --VVV-- 

    $('#drdoh_ticketbundle_guest_birthDate').change(function(){

        var jours = $('#drdoh_ticketbundle_guest_birthDate_day').val();
        var mois = $('#drdoh_ticketbundle_guest_birthDate_month').val();
        var année = $('#drdoh_ticketbundle_guest_birthDate_year').val();
        birthDate= new Date(année,mois,jours);
        visiteDate = new Date();
        console.log(birthDate);
        console.log(date);

    })


// --VVV-- Gestion des reduction --VVV--

    $('#drdoh_ticketbundle_guest_discount').change(function(){
        var discount = $('#drdoh_ticketbundle_guest_discount').val();
        if(discount != 50){
            qte_discount_price ++ ;
            if(qte_full_price>0){
                qte_full_price -- ;
            }
            $('#qte_discount_price').text(qte_discount_price);
            $('#qte_full_price').text(qte_full_price);
        }else{
            qte_discount_price -- ;
            qte_full_price ++ ;
            $('#qte_discount_price').text(qte_discount_price);
            $('#qte_full_price').text(qte_full_price);
        }
    });




// --VVV-- Calcul --VVV--     
    var total_full_price = qte_full_price * full_price;
    var total_child_price = qte_child_price * child_price;
    var total_baby_price = qte_baby_price * baby_price;
    var total_older_price = qte_older_price * older_price;
    var total_discount_price = qte_discount_price * discount_price;
    var total_price = total_full_price+total_child_price+total_baby_price+total_older_price+total_discount_price;

// --VVV-- Modification des valeur du tableau --VVV-- 
    $('#total_full_price').text(total_full_price+",00 €");
    $('#total_child_price').text(total_child_price+",00 €");
    $('#total_baby_price').text(total_baby_price+",00 €");
    $('#total_older_price').text(total_older_price+",00 €");
    $('#total_discount_price').text(total_discount_price+",00 €");
    $('#total_price').text(total_price+",00 €");

})


</script>

{% endblock %}

    
